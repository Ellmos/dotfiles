#!/bin/sh

DUMP_PATH=~/afs/ing1/sql/hello_roger_roger/roger_roger.dump

create()
{
    pkill psql
    pkill postgres
    rm -rf ~/postgres_data

    initdb --locale "$LANG" -E UTF8
    postgres -k "$PGHOST" &> /dev/null &
    sleep 1
    createuser -s postgres
    createdb -U postgres roger_roger
    pg_restore -U postgres -O -d roger_roger $DUMP_PATH
}

delete()
{
    pkill psql
    pkill postgres
    rm -rf ~/postgres_data
}

reload()
{
    pkill psql
    rm -rf $DUMP_PATH
    rm -rf ~/Downloads/hello-roger-roger-provided_files.tar
    rm -rf ~/Downloads/hello_roger_roger

    firefox https://intra.forge.epita.fr/epita-ing-assistants-acu/sql-workshop-2026/root/sql-workshop-2026/bootstrap/hello-roger-roger/hello-roger-roger/hello-roger-roger-provided_files.tar
    read -n 1 -p "Press enter when download is finished" mainmenuinput

    cd ~/Downloads
    tar -xf ~/Downloads/hello-roger-roger-provided_files.tar
    mv ~/Downloads/hello_roger_roger/roger_roger.dump $DUMP_PATH
    cd -


    dropdb -U postgres roger_roger
    createdb -U postgres roger_roger
    pg_restore -U postgres -O -d roger_roger $DUMP_PATH
}

if [ "$1" = "create" ]; then
    create
elif [ "$1" = "delete" ]; then
    delete
elif [ "$1" = "reset" ]; then
    delete
    create
elif [ "$1" = "reload" ]; then
    reload
else
    echo "Usage: create|delete|reset|reload"
    exit 1
fi
